<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Treasure JS SDK Test</title>

	<!-- Test Framework Assets -->
	<link rel="stylesheet" href="./assets/mocha/mocha.css" />
	<script src="./assets/mocha/mocha.js"></script>
	<script src="./assets/chai/chai.js"></script>
	<script src="./assets/sinon/index.js"></script>
	<script src="./assets/sinon-ie/index.js"></script>

  <script>
    window.mocha.setup('bdd');
    window.expect = chai.expect;
  </script>

	<!-- File(s) to be tested -->
	<script src="./dist/td.js" type="text/javascript"></script>

	<!-- Setup -->
	<script src="./treasure.helper.js" type="text/javascript"></script>

	<!-- Load Tests -->
	<script src="./treasure.client.spec.js" type="text/javascript"></script>
	<script src="./treasure.recording.spec.js" type="text/javascript"></script>

	<!-- Initialize -->
	<script>
		var init = function () {

      function logFailure (test, err) {

        var flattenTitles = function (test) {
          var titles = [];
          while (test.parent.title){
            titles.push(test.parent.title);
            test = test.parent;
          }
          return titles.reverse();
        };

        failedTests.push({
          name: test.title,
          result: false,
          message: err.message,
          stack: err.stack,
          titles: flattenTitles(test)
        });
      }

			var runner = mocha.run();

			var failedTests = [];
			runner.on('end', function () {
				window.mochaResults = runner.stats;
				window.mochaResults.reports = failedTests;
			});

			runner.on('fail', logFailure);
		};

		if (window.addEventListener) {
			window.addEventListener('load', init, false );
		}
		else if (window.attachEvent) {
			window.attachEvent('onload', init );
		} else if (window.onLoad) {
			window.onload = init;
		}

	</script>
</head>
<body>
	<div id="mocha"></div>
</body>
</html>
